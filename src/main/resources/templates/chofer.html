<!DOCTYPE html>
<html lang=es>
<head>
    <meta charset=UTF-8>
    <meta name=viewport" content="width=device-width, initial-scale=1.0
    <title>ALL IN - Portal Transportistas</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;6000;900&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: Inter', Segoe UI', Arial, sans-serif; 
            margin: 0;
            padding: 0;
        }
        .chofer-container[object Object]        min-height: 100        background: linear-gradient(135deg, #667ea 0%, #764ba2 100           padding: 20px;
        }
        .chofer-header {
            background: white;
            border-radius:20           padding:30            margin-bottom:20;
            text-align: center;
            box-shadow: 0 10px 30 rgba(0,0,0
        }
        .chofer-title [object Object]       font-family: Sora', sans-serif;
            font-size: 20.5;
            font-weight: 800;
            color: #1e40af;
            margin-bottom: 10px;
        }
        .chofer-subtitle {
            color: #6b7280;
            margin-bottom: 20px;
        }
        .envios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1);
            gap:20            margin-top: 20px;
        }
        .envio-card {
            background: white;
            border-radius:15           padding:25x;
            box-shadow: 0 5px 15 rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .envio-card:hover {
            transform: translateY(-5px);
        }
        .envio-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .envio-codigo [object Object]       font-weight: 600;
            color: #1e40af;
            font-size:1.1
        }
        .envio-estado {
            padding: 5px12            border-radius:20;
            font-size: 0.9;
            font-weight: 600;
        }
        .estado-aceptado {
            background: #dbeafe;
            color: #1e+40
        }
        .estado-en-camino {
            background: #fef3c7;
            color: #d97706;
        }
        .estado-entregado {
            background: #d1
            color: #59669
        }
        .envio-info {
            margin-bottom: 15px;
        }
        .envio-info h3 {
            margin: 0 0 10
            color: #374151
        }
        .envio-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap:10            margin-bottom: 15px;
        }
        .envio-detail [object Object]         font-size: 0.9
            color: #6
        }
        .envio-detail strong {
            color: #374151
        }
        .envio-precio [object Object]         font-size: 1.5;
            font-weight: 700;
            color: #059669;
            text-align: center;
            margin: 15
        }
        .btn-aceptar {
            width:100           padding:12        background: linear-gradient(135deg, #1081%, #059669 100
            color: white;
            border: none;
            border-radius:10;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .btn-aceptar:hover {
            transform: translateY(-2px);
        }
        .btn-aceptar:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }
        .no-envios [object Object]        text-align: center;
            color: white;
            font-size: 1.2            margin-top: 50px;
        }
        .user-info {
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }
        .logout-btn {
            background: rgba(255,0.2);
            color: white;
            border: none;
            padding: 10px20            border-radius: 8px;
            cursor: pointer;
            margin-top: 10;
        }
    </style>
</head>
<body>
    <div class="chofer-container">
        <div class="chofer-header">
            <div class=chofer-title">ALL IN</div>
            <div class=chofer-subtitle">Portal para Transportistas</div>
            <div class="user-info" id="user-info"></div>
            <button class="logout-btn" onclick="logout()">Cerrar Sesión</button>
        </div>

        <div id="envios-container">
            <div class=no-envios" id="no-envios" style=display: none;>                No hay envíos disponibles en este momento.
            </div>
            <div class=envios-grid" id="envios-grid"></div>
        </div>
    </div>

    <script>
        let currentUser = null;

        // Verificar autenticación al cargar
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            loadEnvios();
        });

        function checkAuth() {
            const user = JSON.parse(localStorage.getItem('user'));
            const userType = localStorage.getItem('userType');
            
            if (!user || userType !== 'chofer')[object Object]             alert('Debe iniciar sesión como transportista');
                window.location.href = '/login.html;            return;
            }
            
            currentUser = user;
            document.getElementById('user-info).textContent = `Bienvenido, ${user.nombre} ${user.apellido}`;
        }

        async function loadEnvios()[object Object]            try[object Object]             const response = await fetch(/api/envio/disponibles');
                const envios = await response.json();
                
                const grid = document.getElementById('envios-grid');
                const noEnvios = document.getElementById('no-envios');
                
                if (envios.length === 0) {
                    grid.style.display = 'none';
                    noEnvios.style.display = 'block';
                    return;
                }
                
                grid.style.display = 'grid;                noEnvios.style.display = 'none';
                
                grid.innerHTML = envios.map(envio => `
                    <div class="envio-card">
                        <div class="envio-header">
                            <div class="envio-codigo">${envio.codigoSeguimiento}</div>
                            <div class="envio-estado estado-aceptado">Disponible</div>
                        </div>
                        <div class="envio-info">
                            <h3>Detalles del Envío</h3>
                            <div class="envio-details">
                                <div class="envio-detail">
                                    <strong>Origen:</strong><br>
                                    ${envio.origen}
                                </div>
                                <div class="envio-detail">
                                    <strong>Destino:</strong><br>
                                    ${envio.destino}
                                </div>
                                <div class="envio-detail">
                                    <strong>Peso:</strong><br>
                                    ${envio.carga.peso} kg
                                </div>
                                <div class="envio-detail">
                                    <strong>Dimensiones:</strong><br>
                                    ${envio.carga.largo}x${envio.carga.ancho}x${envio.carga.altura} cm
                                </div>
                            </div>
                        </div>
                        <div class="envio-precio">
                            $${envio.costoTotal.toLocaleString('es-AR')}
                        </div>
                        <button class="btn-aceptaronclick="aceptarEnvio(${envio.id})">
                            Aceptar Envío
                        </button>
                    </div>
                `).join('');
                
            } catch (error)[object Object]           console.error('Error al cargar envíos:', error);
                document.getElementById('no-envios).textContent = 'Error al cargar envíos;          document.getElementById(no-envios).style.display = 'block';
            }
        }

        async function aceptarEnvio(envioId)[object Object]            try[object Object]             const response = await fetch(`/api/envio/aceptar/${envioId}`, {
                    method: 'POST',
                    headers: {
                       Content-Type':application/json'
                    },
                    body: JSON.stringify({
                        choferId: currentUser.id
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    alert(`¡Envío aceptado exitosamente!\nCódigo: ${result.codigoSeguimiento}`);
                    loadEnvios(); // Recargar la lista
                } else {
                    alert(`Error: ${result.message}`);
                }
            } catch (error)[object Object]           console.error('Error al aceptar envío:', error);
                alert('Error al aceptar el envío);         }
        }

        function logout() {
            localStorage.removeItem('user');
            localStorage.removeItem('userType');
            window.location.href = '/';
        }

        // Recargar envíos cada 30gundos
        setInterval(loadEnvios, 3000;
    </script>
</body>
</html> 